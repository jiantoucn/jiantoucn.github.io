<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live2D é¢éƒ¨æ•æ‰ Web æ¼”ç¤º</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <style>
        body { margin: 0; overflow: hidden; background-color: #202020; font-family: sans-serif; }
        #canvas { width: 100vw; height: 100vh; display: block; }
        
        /* UI è¦†ç›–å±‚ */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: white;
            max-width: 300px;
        }
        
        #video-preview {
            width: 100%;
            border-radius: 4px;
            margin-top: 10px;
            transform: scaleX(-1); /* é•œåƒç¿»è½¬ */
            background: #000;
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #output-canvas {
            width: 100%;
            border-radius: 4px;
            margin-top: 10px;
            transform: scaleX(-1);
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2; /* åœ¨è§†é¢‘ä¹‹ä¸Š */
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€ */
        }

        /* è§†é¢‘å®¹å™¨ï¼Œç”¨äºé‡å  video å’Œ canvas */
        .video-container {
            position: relative;
            width: 100%;
            padding-top: 75%; /* 4:3 æ¯”ä¾‹ */
            display: none; /* åˆå§‹éšè— */
            margin-top: 10px;
        }
        
        .video-container video, .video-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        input[type="text"] {
            width: 100%;
            padding: 5px;
            margin-bottom: 5px;
            box-sizing: border-box;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 5px;
        }
        
        button:hover { background: #0056b3; }
        button:disabled { background: #555; cursor: not-allowed; }
        
        .status { font-size: 12px; color: #aaa; margin-top: 5px; }
    </style>

    <!-- æ ¸å¿ƒä¾èµ– -->
    <!-- Cubism Core (å¿…é¡»åœ¨ pixi-live2d-display ä¹‹å‰åŠ è½½) -->
    <script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
    <!-- Cubism 2 Core -->
    <script src="https://cdn.jsdelivr.net/gh/dylanNew/live2d/webgl/Live2D/lib/live2d.min.js"></script>
    
    <!-- PixiJS -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@6.5.1/dist/browser/pixi.min.js"></script>
    
    <!-- Pixi-Live2D-Display (ä½¿ç”¨æœ€æ–°ç‰ˆ) -->
    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display/dist/index.min.js"></script>
    
    <!-- JSZip (ç”¨äºè§£å‹æ¨¡å‹å‹ç¼©åŒ…) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- MediaPipe Drawing Utils (ç”¨äºç»˜åˆ¶éª¨éª¼) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

    <!-- Kalidokit (é¢éƒ¨è§£ç®—) -->
    <script src="https://cdn.jsdelivr.net/npm/kalidokit@1.1.5/dist/kalidokit.umd.js"></script>
    
    <!-- MediaPipe Face Mesh -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>

    <div id="ui-layer">
        <h3>Live2D é¢éƒ¨æ•æ‰ <span style="font-size: 0.6em; color: #888; background: #333; padding: 2px 4px; border-radius: 4px;">v1.8</span></h3>
        
        <!-- æœ¬åœ°ä¸Šä¼ åŒºåŸŸ -->
        <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 15px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">æ–¹å¼ä¸€ï¼šä¸Šä¼ æ¨¡å‹å‹ç¼©åŒ… (æ¨è)</label>
            <div style="font-size: 12px; color: #ccc; margin-bottom: 8px;">
                è¯·ä¸Šä¼ åŒ…å«æ¨¡å‹çš„ <code style="background:#444; padding:2px;">.zip</code> æ–‡ä»¶
            </div>
            <input type="file" id="file-input" accept=".zip" style="display: none;">
            <button onclick="document.getElementById('file-input').click()" style="background: #28a745;">ğŸ“¦ é€‰æ‹© ZIP å‹ç¼©åŒ…</button>
        </div>

        <!-- ç½‘ç»œé“¾æ¥åŒºåŸŸ -->
        <div style="margin-bottom: 10px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">æ–¹å¼äºŒï¼šç½‘ç»œé“¾æ¥ / é¢„è®¾</label>
            <select id="preset-select" style="width:100%; padding:5px; margin-bottom:5px; background:#333; color:white; border:1px solid #555;">
                <option value="miku/runtime/miku.model3.json" selected>Miku (æœ¬åœ°)</option>
                <option value="hiyori_free_zh/runtime/hiyori_free_t08.model3.json">Hiyori (æœ¬åœ°)</option>
                <option value="mark_free_zh/runtime/mark_free_t04.model3.json">Mark (æœ¬åœ°)</option>
                <option value="https://cdn.jsdelivr.net/gh/guansss/pixi-live2d-display/test/assets/haru/haru_greeter_t03.model3.json">Haru (åœ¨çº¿)</option>
            </select>
            <input type="text" id="model-url" placeholder="è¾“å…¥ .model3.json é“¾æ¥" value="miku/runtime/miku.model3.json">
            <button id="btn-load">ğŸŒ åŠ è½½æ¨¡å‹</button>
        </div>

        <hr style="border-color: #444;">

        <button id="btn-camera">ğŸ“· å¼€å¯æ‘„åƒå¤´</button>
        <button id="btn-refresh" style="background: #6c757d; margin-top: 5px;">ğŸ”„ å¼ºåˆ¶åˆ·æ–°ç¼“å­˜</button>
        <div class="status" id="status-text">å‡†å¤‡å°±ç»ª</div>
        
        <div class="video-container" id="video-container">
            <video id="video-preview" playsinline></video>
            <canvas id="output-canvas"></canvas>
        </div>
    </div>

    <canvas id="canvas"></canvas>

    <!-- æ¨¡å—åŒ–è„šæœ¬ -->
    <script src="js/live2d-controller.js"></script>
    <script src="js/camera-controller.js"></script>
    <script src="js/main.js"></script>

</body>
</html>
